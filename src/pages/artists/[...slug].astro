---
import { getCollection } from 'astro:content';

import ArtistInfo from "@components/artists/ArtistInfo.astro";
import PlayerLayout from "@layouts/PlayerLayout.astro";
import Artists from "@components/artists/Artists.astro";
import Share from '~components/ux/Share.astro';

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
	const artists = await getCollection('artists');
	return artists.map(artist => ({
		params: { slug: artist.slug },
		props: { artist },
	}));
}

const { artist } = Astro.props;
const { Content } = await artist?.render();

function sentenceArray(array:[], word:string = 'and'){
	let sentence

	if (!array || !array.length)
	return

	if (array.length == 1)
	return array[0]

	for (let index = 0; index < array.length; index++) {
		if (index + 1 == array.length)
		sentence = sentence ? sentence + ' ' + word + ' ' + array[index] : array[index];
		else
		sentence = sentence ? sentence + ', ' + array[index] : array[index]

	}
	return sentence
}
---

<PlayerLayout title={artist.data?.title + " A.K.A. " + artist.data?.name } description={"Get to know " + artist.data?.title} image={artist.data?.image} imageAlt={artist.data?.imageAlt}>
	<article class="flex align-items-stretch landscape:w-full portrait:flex-col landscape:flex-row-reverse landscape:text-right">
		<div class="landscape:sticky landscape:top-0">
			<ArtistInfo artist={artist} />
		</div>

		{artist.data?.autogenerated &&

			<div class="media-content grow-1  p-10 portrait:px-6 portrait:py-12">
				<div class="content p-4 text-2xl prose prose-table:table-auto prose-p:text-xl prose-p:text-token prose-headings:text-token">
					<h3 class="marker text-3xl">The Artist</h3>

					<p class="unstyled">
						{(artist.data?.title && artist.data?.meaning || artist.data?.genres && artist.data?.languages || artist.data?.experience) &&
							<span>
								{artist.data?.name} is a music artist that records and performs under the name {artist.data?.title}.

								{artist.data?.meaning &&
									<span>{artist.data?.sex == "male" ? 'His' : 'Her'} artist name means {artist.data?.meaning}.</span>
								}
							</span>
						}

						{artist.data?.genres && artist.data?.languages &&
							<span>{artist.data?.title} makes music in {sentenceArray(artist.data?.genres)} in the languages {sentenceArray(artist.data?.languages)}.</span>
						}

						{artist.data?.experience &&
							<span>{artist.data?.sex == "male" ? 'His' : 'Her'} audience can expect {artist.data?.experience}.</span>
						}
					</p>

					{(artist.data?.profession || artist.data?.vocal_type || artist.data?.vocal_skills || artist.data?.performance_setup) &&
						<h3 class="marker text-3xl">The Music</h3>
						<p class="unstyled">
							{artist.data?.title} is active as {sentenceArray(artist.data?.profession)} of {artist.data?.sex == "male" ? 'his': 'her'} own songs {artist.data?.profession == 'featured artist' &&
								<span> and features in songs of other artists as well.</span>
							}
							{artist.data?.vocal_type &&
								<span>{artist.data?.sex == "male" ? 'His' : 'Her'} {artist.data?.vocal_type?.length > 1 ? 'voices are' : 'voice is'} {sentenceArray(artist.data?.vocal_type)}.</span>
							}
							which {artist.data?.sex == "male" ? 'he' : 'she'} performs
							{artist.data?.vocal_skills &&
								<span> {sentenceArray(artist.data?.vocal_skills)}</span>
							}
							with {sentenceArray(artist.data?.performance_setup, 'or')}.
						</p>
					}

					{(artist.data?.vision || artist.data?.mission) &&
						<h3 class="marker text-3xl">Vision & Mission</h3>
						<p class="unstyled">
							{artist.data?.vision &&
								<span>{artist.data?.sex == "male" ? 'His' : 'Her'} vision is {artist.data?.vision}.</span>
							}
							{artist.data?.mission &&
								<span>{artist.data?.sex == "male" ? 'His' : 'Her'} mission is {artist.data?.mission}.</span>
							}
						</p>
					}

					{(artist.data?.wishes || artist.data?.reason) &&
						<h3 class="marker text-3xl">Motivations & Influences</h3>
						<p class="unstyled">
							{artist.data?.reason &&
								<span>{artist.data?.title} makes music {artist.data?.reason}.</span>
							}
							{artist.data?.wishes &&
								<span>{artist.data?.sex == "male" ? 'He' : 'She'} wishes everyone {artist.data?.wishes}.</span>
							}
						</p>
					}

					{(artist.data?.motivation || artist.data?.inspiration) &&
						<p class="unstyled">
							{artist.data?.motivation &&
								<span>What motivates {artist.data?.sex == "male" ? 'him' : 'her'} to create {artist.data?.sex == "male" ? 'his' : 'her'} music {artist.data?.motivation}.</span>
							}
							{artist.data?.inspiration &&
								<span>{artist.data?.sex == "male" ? 'He' : 'She'} finds inspiration {artist.data?.inspiration}.</span>
							}
						</p>
					}

					{(artist.data?.youth_influences || artist.data?.influential_artists) &&
						<h3 class="marker text-3xl">Music & Life</h3>
						<p class="unstyled">
							{artist.data?.youth_influences &&
								<span>Growing up {artist.data?.sex == "male" ? 'his' : 'her'} main musical influences came from {artist.data?.youth_influences}.</span>
							}
							{artist.data?.influential_artists &&
								<span>{artist.data?.title} is influenced by popular artists like {artist.data?.influential_artists}.</span>
							}
						</p>
					}

					{(artist.data?.purpose || artist.data?.society)  &&
						<h3 class="marker text-3xl">Society & Success</h3>
						<p class="unstyled">
							{artist.data?.purpose &&
								<span>The purpose of {artist.data?.sex == "male" ? 'his' : 'her'} work is to {artist.data?.purpose}</span>
							}
							{artist.data?.solution &&
								<span> and {artist.data?.sex == "male" ? 'he' : 'she'} is convinced {artist.data?.sex == "male" ? 'his' : 'her'} music affects societal issues {artist.data?.solution}.</span>
							}
						</p>
					}

					{(artist.data?.success || artist.data?.actions || artist.data?.feedback) &&
						<p class="unstyled">
							{artist.data?.success &&
								<span>{artist.data?.title} defines success by {artist.data?.success}.</span>
							}
							{artist.data?.actions &&
								<span>{artist.data?.sex == "male" ? 'He' : 'She'} develops {artist.data?.sex == "male" ? 'his' : 'her'} skills by {artist.data?.actions}.</span>
							}
							{artist.data?.feedback &&
								<span>{artist.data?.sex == "male" ? 'He' : 'She'} embraces feedback from critics and music lovers because {artist.data?.feedback}.</span>
							}
						</p>
					}
				</div>
			<hr />
		</div>
			}

			{artist.data?.autogenerated == false &&
				<div class="content p-4 text-2xl prose prose-table:table-auto prose-p:text-xl prose-p:text-token prose-headings:text-token">
					<Content />
				</div>
			}

	</article>

	<div class="flex justify-center items-center">
		<!-- <Share data={artist.data} /> -->
	</div>

	<Artists />
</PlayerLayout>